/*v1.6*/var arrLinksToCheck=[];var strTld;var strAffiliateId;function linkAmazon(b,d){this.objLink=b;if(d){this.strAsin=d}this.affiliateLink=function(){this.objLink.href="http://www.amazon."+this.getActualTld()+"/exec/obidos/ASIN/"+this.strAsin+"/"+getAffiliateId(arrTldActual[1])};this.searchLink=function(){var a=new RegExp("amazon.[a-zA-Z.]{2,5}/([A-Za-z-]*)/dp");arrResult=a.exec(this.objLink.href);if(arrResult){strTitle=arrResult[1].replace(/-/g,"%20");this.writeSearchLink(strTitle)}else{strUrlProduct=strUrlAjax+"?strAction=search&strLink="+this.objLink.href;objScript=document.createElement("script");objScript.src=strUrlProduct;document.getElementsByTagName("head")[0].appendChild(objScript)}};this.writeSearchLink=function(a){this.objLink.href="http://www.amazon."+strTld+"/s?keywords="+a+"&tag="+strAffiliateId};this.getAffiliateUrl=function(){return"http://www.amazon."+strTld+"/exec/obidos/ASIN/"+this.strAsin+"/"+strAffiliateId};this.localiseLink=function(){this.objLink.href=this.getAffiliateUrl()};this.getActualTld=function(){var c=new RegExp("amazon.(.*?)/");arrTldActual=c.exec(this.objLink.href);return arrTldActual[1]}}function findLocation(){if(typeof google!="undefined"&&google.loader.ClientLocation!=null){var a=google.loader.ClientLocation.address.country_code;checkAmazonLinks(a)}else{objScript=document.createElement("script");objScript.src="http://freegeoip.net/json/?callback=checkAmazonLinks";document.getElementsByTagName("head")[0].appendChild(objScript)}}function checkAmazonLinks(a){var b=new RegExp("/([A-Z0-9]{10})");if(a){if(typeof a.country_code!="undefined"){a=a.country_code}switch(a){case'GB':case'IE':strTld='co.uk';break;case'AT':strTld='de';default:strTld=(arrAffiliates[a.toLowerCase()]?a.toLowerCase():'com');break}strAffiliateId=getAffiliateId(strTld)}var c=document.getElementsByTagName("a");for(i=0,j=c.length;i<j;i++){var d=c[i].href.toLowerCase().indexOf("amazon.");if(d>0&&d<c[i].href.substring(8).indexOf("/")+8&&c[i].href.indexOf("/review/")<0){var e=b.exec(c[i].href);if(e){objLink=new linkAmazon(c[i],e[1]);if(strTld&&strTld!=objLink.getActualTld()){arrLinksToCheck[e[1]]=objLink}else{objLink.affiliateLink()}}else{var f=c[i].href.indexOf("tag=");if(!strTld){objLink=new linkAmazon(c[i]);strTldChecked=objLink.getActualTld()}else{strTldChecked=strTld}if(f>0){f+=4;var g=c[i].href.substring(f).indexOf("&");if(g<0){g=c[i].href.length-f}c[i].href=c[i].href.substring(0,f)+getAffiliateId(strTldChecked)+c[i].href.substring((g+f));intPath=c[i].href.indexOf("/",c[i].href.indexOf("amazon"));c[i].href="http://www.amazon."+strTldChecked+c[i].href.substring(intPath)}else{intPath=c[i].href.indexOf("/",c[i].href.indexOf("amazon"));c[i].href=c[i].href.substring(0,c[i].href.indexOf("amazon."))+"amazon."+strTldChecked+c[i].href.substring(intPath)+(c[i].href.indexOf("?")>0?"&":"?")+"tag="+getAffiliateId(strTldChecked)}}}}if(strTld){var h="";for(strKey in arrLinksToCheck){if(typeof arrLinksToCheck[strKey].strAsin!="undefined"){h+=arrLinksToCheck[strKey].strAsin+"|"}}if(h.length){var k=strUrlAjax+"?strTld="+strTld+"&strAffiliateId="+strAffiliateId+"&strLinks="+h;k=k.substring(0,k.length-1);objScript=document.createElement("script");objScript.src=k;document.getElementsByTagName("head")[0].appendChild(objScript)}}}function getAffiliateId(a){return(arrAffiliates[a]?arrAffiliates[a]:arrAffiliatesSpares[a])}if(window.addEventListener){window.addEventListener("load",findLocation,false)}else{window.attachEvent("onload",findLocation)}var arrAffiliatesSpares={'co.uk':'pcrev05','com':'petewill-20','de':'petewill05-21','fr':'petewill-21','ca':'petewill00-20','co.jp':'petewill-22','jp':'petewill-22','it':'petewill04-21','cn':'petewill-23'};