var arrLinksToCheck=new Array();var strTld;var strAffiliateId;function linkAmazon(b,a){this.objLink=b;this.strAsin=a;this.getAffiliateUrl=function(){return"http://www.amazon."+strTld+"/exec/obidos/ASIN/"+this.strAsin+"/"+strAffiliateId};this.affiliateLink=function(){this.objLink.href="http://www.amazon."+this.getActualTld()+"/exec/obidos/ASIN/"+this.strAsin+"/"+getAffiliateId(arrTldActual[1])};this.localiseLink=function(){this.objLink.href=this.getAffiliateUrl()};this.getActualTld=function(){var c=new RegExp("amazon.(.*?)/");arrTldActual=c.exec(this.objLink.href);return arrTldActual[1]}}function checkAmazonLinks(){var h=new RegExp("/([A-Z0-9]{10})");if(typeof google!="undefined"){var a=google.loader.ClientLocation.address.country_code}switch(a){case"GB":case"IE":strTld="co.uk";break;case"AT":strTld="de";default:strTld=(arrAffiliates[a.toLowerCase()]?a.toLowerCase():"com");break}strAffiliateId=getAffiliateId(strTld);var f=document.getElementsByTagName("a");for(i=0,ii=f.length;i<ii;i++){var c=f[i].href.toLowerCase().indexOf("amazon.");if(c>0&&c<f[i].href.substring(8).indexOf("/")+8){var d=h.exec(f[i].href);if(d){objLink=new linkAmazon(f[i],d[1]);if(strTld!=objLink.getActualTld()){arrLinksToCheck[d[1]]=objLink}else{objLink.affiliateLink()}}else{var b=f[i].href.indexOf("tag=");if(b>0){b+=4;var g=f[i].href.substring(b).indexOf("&");if(g<0){g=f[i].href.length-b}f[i].href=f[i].href.substring(0,b)+getAffiliateId(strTld)+f[i].href.substring((g+b));intPath=f[i].href.indexOf("/",f[i].href.indexOf("amazon"));f[i].href="http://www.amazon."+strTld+f[i].href.substring(intPath)}else{intPath=f[i].href.indexOf("/",f[i].href.indexOf("amazon"));f[i].href=f[i].href.substring(0,f[i].href.indexOf("amazon."))+"amazon."+strTld+f[i].href.substring(intPath)+(f[i].href.indexOf("?")>0?"&":"?")+"tag="+getAffiliateId(strTld)}}}}var e="";for(strKey in arrLinksToCheck){e+=arrLinksToCheck[strKey].strAsin+"|"}if(e.length){strUrlAjax+="?strTld="+strTld+"&strAffiliateId="+strAffiliateId+"&strLinks="+e;strUrlAjax=strUrlAjax.substring(0,strUrlAjax.length-1);objScript=document.createElement("script");objScript.src=strUrlAjax;document.getElementsByTagName("head")[0].appendChild(objScript)}}function getAffiliateId(a){return(arrAffiliates[a]?arrAffiliates[a]:arrAffiliatesSpares[a])}if(window.addEventListener){window.addEventListener("load",checkAmazonLinks,false)}else{window.attachEvent("onload",checkAmazonLinks)}var arrAffiliatesSpares={"co.uk":"pcrev05","com":"petewill-20","de":"petewill05-21","fr":"petewill-21","ca":"petewill00-20","jp":"petewill-22"};
